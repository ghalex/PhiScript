function $redrawElement(a){var b=new Element("div");b.inject(a);setTimeout(function(){b.destroy()},1)}function $bubbleEvent(a){if(a.target==this)return;this.fireEvent(a.type,a)}var phi=phi||{};phi.core=phi.core||{};phi.ui=phi.ui||{};phi.html=phi.html||{};phi.mn=phi.mn||{};phi.collections=phi.collections||{};Object.forEachChild=function(a,b,c){if(instanceOf(a,phi.ui.Container)){var d=a.createIterator();while(d.moveNext())if(c(d.current()))Object.forEachChild(d.current(),b,c)}b(a)};Array.implement({pushAt:function(a,b){this.splice(b,0,a)}});Boolean.fromString=function(a){if(a=="true")return true;return false};Number.isPercentage=function(a){if(instanceOf(a,String))if(a.indexOf("%")>-1)return true;return false};Number.withPx=function(a){return Number.from(a)+"px"};var VerticalAlign={};VerticalAlign.TOP="top";VerticalAlign.MIDDLE="middle";VerticalAlign.BOTTOM="bottom";var HorizontalAlign={};HorizontalAlign.LEFT="left";HorizontalAlign.CENTER="center";HorizontalAlign.RIGHT="right";var CollectionEventKind={};CollectionEventKind.ADD="add";CollectionEventKind.REMOVE="remove";CollectionEventKind.REPLACE="replace";CollectionEventKind.MOVE="move";var PopUpSnap={};PopUpSnap.LEFT="left";PopUpSnap.TOP="top";PopUpSnap.RIGHT="right";PopUpSnap.BOTTOM="bottom";PopUpSnap.mapSide={left:"topLeft",top:"topLeft",right:"topRight",bottom:"bottomLeft"};PopUpSnap.mapEdge={left:"topRight",top:"bottomLeft",right:"topLeft",bottom:"topLeft"};Events.implement({dispatchEvent:function(a,b){b=b||{};b.target=this;this.fireEvent(a,b)},hasEvent:function(a,b){if(!this.$events[a])return false;var c=false;this.$events[a].each(function(a){if(b==a){c=true;return}});return c}});phi.core.ProxyObject=new Class({Implements:[Events],attributes:{},initialize:function(a){this.set(a)},set:function(a){Object.append(this.attributes,a);this.dispatchEvent("propertyChange")},get:function(a){return this.attributes[a]},unset:function(a){delete this.attributes[a];this.dispatchEvent("propertyChange")}});phi.core.ChildList=new Class({Implements:[Events],children:[],addChild:function(a){return this.addChildAt(a,this.children.length)},addChildAt:function(a,b){if(!instanceOf(a,phi.ui.Component))throw new Error("Child must be an instance of phi.ui.Component!");if(a.getParent()!==null)a.getParent().removeChild(a);if(!this.hasChild(a)){this.children.pushAt(a,b);this.dispatchEvent("childAdded",{child:a,index:b});a.setParent(this);a.dispatchEvent("added",{index:b})}return this},moveChild:function(a,b){var c=this.getChildIndex(a);if(childIndex>-1){this.children.erase(a);this.children.pushAt(a,b);this.dispatchEvent("childMoved",{child:a,oldIndex:c,newIndex:b});a.dispatchEvent("moved",{oldIndex:c,newIndex:b})}},getChildAt:function(a){return this.children[a]},getChildIndex:function(a){return this.children.indexOf(a)},lastChild:function(){return this.getChildAt(this.children.length-1)},firstChild:function(){return this.getChildAt(0)},removeChild:function(a){if(!instanceOf(a,phi.ui.Component))throw new Error("Child must be a phi.ui.Component!");var b=this.getChildIndex(a);this.children.erase(a);a.setParent(null);a.dispatchEvent("removed",{index:b});this.dispatchEvent("childRemoved",{child:a,index:b});return a},hasChild:function(a){for(var b=0;b<this.children.length;b++){if(a==this.children[b])return true}return false},removeChildAt:function(a){return this.removeChild(this.getChildAt(a))},getChildren:function(){return this.children},removeAllChildren:function(){this.children=[]}});phi.core.Iterator=new Class({initialize:function(a){if(!a)throw new Error("Collection cannot be null!");if(!instanceOf(a,phi.collections.ArrayCollection))throw new Error("Collection must be a ArrayCollection!");this.collection=a;this.currentIndex=-1},moveNext:function(){if(this.currentIndex<this.collection.length()-1){this.currentIndex++;return true}return false},movePrevious:function(){if(this.currentIndex>0){this.currentIndex--;return true}return false},moveFirst:function(){this.currentIndex=0;return this},moveLast:function(){this.currentIndex=this.collection.length()-1;return this},current:function(){return this.collection.getItemAt(this.currentIndex)}});Element.implement({instance:function(){return this.retrieve("instance")},copyAttributes:function(a){for(var b=0;b<a.attributes.length;b++){this.set(a.attributes[b].name,a.attributes[b].value)}},getAttributes:function(){var a={};for(var b=0;b<this.attributes.length;b++){a[this.attributes[b].name]=this.attributes[b].value}return a},getChildByTag:function(a){var b=this.getChildren();for(var c=0;c<b.length;c++){if(b[c].get("tag").toLowerCase()==a.toLowerCase())return b[c]}return null},getChildrenByTag:function(a){var b=this.getChildren();var c=[];for(var d=0;d<b.length;d++){if(b[d].get("tag").toLowerCase()==a.toLowerCase())c.push(b[d])}return c},getParentByTag:function(a){var b=this.getParent();if(!b)return null;if(b.get("tag")==a)return b;return b.getParentByTag(a)},getParentByClass:function(a){var b=this.getParent();if(!b)return null;if(b.hasClass(a))return b;return b.getParentByClass(a)},setWidth:function(a){if(this.get("tag")=="table"){this.set("width",a);return}this.setStyle("width",a)},setHeight:function(a){if(this.get("tag")=="table"){this.set("height",a);return}this.setStyle("height",a)},getWidth:function(){if(this.get("tag")=="table")return this.get("width");return this.getStyle("width")},getHeight:function(){if(this.get("tag")=="table")return this.get("height");return this.getStyle("height")}});phi.html.Table=new Class({Extends:HtmlTable,pushElement:function(a,b,c){var d=new Element("tr",{});var e=new Element("td",{align:"left"});if(b===null||this.body.rows.length===0||b==this.body.rows.length){d.inject(this.body);e.inject(d);a.inject(e);return{tr:d,td:e}}d=this.tr(b);if(c===null){var f=d;d=new Element("tr",{});d.inject(f,"before");e.inject(d);a.inject(e);return{tr:d,td:e}}if(c!==null&&c<d.children.length){var g=this.td(b,c);if(g)e.inject(g,"before")}else{e.inject(d)}a.inject(e);return{tr:d,td:e}},tr:function(a){return this.body.rows[a]},td:function(a,b){return this.tr(a).getChildrenByTag("td")[b]}});phi.core.BindWatcher=new Class({Implements:[Events],Binds:["applyBind"],target:null,targetProperty:null,source:null,sourceProperty:null,initialize:function(a,b,c,d){this.target=a;this.targetProperty=b;this.source=c;this.sourceProperty=d;this.bindSource();this.applyBind()},getSource:function(){return this.source},bindSource:function(){var a=this.getSource();if(a===null||a===undefined)return;if(a.addEvent){if(!this.isSourceBind())a.addEvent("propertyChange",this.applyBind)}else console.warn("Source ("+a+") cannot be bind, please use 'ProxObject' to wrap your object for binding to work!")},isSourceBind:function(){return this.getSource().hasEvent("propertyChange",this.applyBind)},applyBind:function(){var a=this.getSource();var b=null;if(this.getSource()===null||this.getSource()===undefined)return;if(a.get)b=a.get(this.sourceProperty);else b=a[this.sourceProperty];if(this.target.set)this.target.set(this.targetProperty,b);else this.target[this.targetProperty]=b}});phi.core.BindViewWatcher=new Class({Extends:phi.core.BindWatcher,Implements:[Events],Binds:["updateChain"],view:null,chain:[],initialize:function(a,b,c,d,e){this.parent(b,c,d,e);this.view=a;this.chain=[];this.updateChain()},updateChain:function(a){if(this.getSource()!=null){this.bindSource();this.applyBind();return}this.removeAllListners();var b=this.view;var c=this.source.split(".");b.addEvent("propertyChange",this.updateChain);this.chain.push(b);c.each(function(a,c){if(b!=null){b=b[a];if(b){b.addEvent("propertyChange",this.updateChain);this.chain.push(b)}}},this)},getSource:function(){if(this.source=="")return this.view;var a=this.view;var b=this.source.split(".");b.each(function(b,c){if(a!=null){a=a[b]||a.get(b)}});return a},removeAllListners:function(){this.chain.each(function(a,b){a.removeEvent("propertyChange",this.updateChain)},this);this.chain=[]}});phi.core.MessageDispatcher=new Class({Implements:[Events],initialize:function(){if(phi.core.MessageDispatcher.instance)throw new Error("Please use Phi.Mvc.Dispatcher.getInstance() to access Dispatcher!");phi.core.MessageDispatcher.instance=this}});phi.core.MessageDispatcher.getInstance=function(){return phi.core.MessageDispatcher.instance||new phi.core.MessageDispatcher};phi.collections.ArrayCollection=new Class({Implements:[Events],useProxy:false,source:[],initialize:function(a){if(a){this.useProxy=a.useProxyObjects;this.parseSource(a.source)}},addItem:function(a){this.addItemAt(a,this.source.length)},addItemAt:function(a,b){var c={};var d=this.wrapItem(a);c.item=d;c.index=b;c.location=b;c.kind=CollectionEventKind.ADD;this.source.splice(b,0,d);this.dispatchEvent("collectionChange",c)},setItemAt:function(a,b){var c={};var d=this.wrapItem(a);c.item=d;c.oldItem=this.getItemAt(b);c.location=b;c.kind=CollectionEventKind.REPLACE;this.source.splice(b,1,d);this.dispatchEvent("collectionChange",c)},moveItem:function(a,b){var c={};var d=this.wrapItem(a);c.item=d;c.oldLocation=this.getItemIndex(a);c.location=b;c.kind=CollectionEventKind.MOVE;this.source.splice(c.oldLocation,1);this.source.splice(c.location,0,d);this.dispatchEvent("collectionChange",c)},removeItem:function(a){this.removeItemAt(this.getItemIndex(a))},removeItemAt:function(a){var b={};b.item=this.getItemAt(a);b.location=a;b.kind=CollectionEventKind.REMOVE;this.source.splice(a,1);this.dispatchEvent("collectionChange",b)},getItemAt:function(a){return this.source[a]},getItemIndex:function(a){return this.source.indexOf(a)},createIterator:function(){return new phi.core.Iterator(this)},useProxyObjects:function(a){this.useProxy=a},length:function(){return this.source.length},wrapItem:function(a){var b=a;if(this.useProxy&&!instanceOf(a,phi.core.ProxyObject))b=new phi.core.ProxyObject(a);return b},toString:function(){return this.source.toString()},parseSource:function(a){a.each(function(a){this.addItem(a)},this)}});phi.mn.PopUpManager={};phi.mn.PopUpManager.popups=[];phi.mn.PopUpManager.createPopUp=function(a,b){var c=new phi.ui.PopUp(b);c.uid=String.uniqueID();c.addChild(new a);phi.mn.PopUpManager.popups[c.uid]=c;return c};phi.mn.PopUpManager.removePopUp=function(a){if(a===null)return;if(!instanceOf(a,phi.ui.PopUp))throw new Error("PopUp must be an instance of phi.ui.PopUp!");var b=phi.ui.RootBox.get();if(b.hasChild(a)){if(a.modal)b.removeChild(a.modal);b.removeChild(a)}delete phi.mn.PopUpManager.popups[a.uid]};phi.mn.PopUpManager.addPopUp=function(a,b){if(a===null)return;if(!instanceOf(a,phi.ui.PopUp))throw new Error("PopUp must be an instance of phi.ui.PopUp!");var c=phi.ui.RootBox.get();if(c.hasChild(a))return;if(b){a.modal=new phi.ui.Modal;c.addChild(a.modal)}c.addChild(a)};phi.mn.PopUpManager.getPopUpForView=function(a){for(var b in phi.mn.PopUpManager.popups){var c=phi.mn.PopUpManager.popups[b];if(c.firstChild()==a)return c}return null};phi.mn.PopUpManager.bringToFront=function(a){if(a===null)return;if(!instanceOf(a,phi.ui.PopUp))throw new Error("PopUp must be an instance of phi.ui.PopUp!");var b=phi.ui.RootBox.get();if(b.hasChild(a)){if(a.modal)b.moveChild(a.modal,b.getChildren().length-1);b.moveChild(a,b.getChildren().length-1)}};phi.mn.ThemeManager={};phi.mn.ThemeManager.directory="assets/themes/";phi.mn.ThemeManager.theme="default";phi.mn.ThemeManager.setDirectory=function(a){phi.mn.ThemeManager.directory=a};phi.mn.ThemeManager.load=function(a){var b=phi.mn.ThemeManager.directory;var c=new Element("link",{id:"theme_"+a,rel:"stylesheet",href:b+a+"/css/"+a+".css",type:"text/css"});phi.mn.ThemeManager.unload(phi.mn.ThemeManager.theme);phi.mn.ThemeManager.theme=a;c.inject($$("head")[0])};phi.mn.ThemeManager.unload=function(a){var b=$("theme_"+a);if(b)b.dispose()};phi.mn.BindManager={};phi.mn.BindManager.watchers=[];phi.mn.BindManager.bind=function(a,b,c,d){var e=new phi.core.BindWatcher(a,b,c,d);phi.mn.BindManager.watchers.push(e);return e};phi.mn.BindManager.bindUsingView=function(a,b,c,d,e){var f=new phi.core.BindViewWatcher(a,b,c,d,e);phi.mn.BindManager.watchers.push(f);return f};phi.mn.BindManager.removeWatchers=function(a){phi.mn.BindManager.watchers.each(function(b){if(b.target==a){b.destory();phi.mn.BindManager.watchers.erase(b)}})};phi.ui.Object=new Class({Extends:Options,Implements:[Events],options:{binds:{}},binds:null,initialize:function(a){this.addEvent("optionsChange",this.onOptionsChange);this.setOptions(a)},setOptions:function(a){this.parent(a);if(a)if(a.binds)this.binds=a.binds;this.dispatchEvent("optionsChange")},set:function(a,b){var c="set"+String.capitalize(a);var d=this[c].bind(this);d(b)},get:function(a){var b="get"+String.capitalize(a);if(this[b]){var c=this[b].bind(this);return c()}return null}});phi.ui.Component=new Class({Extends:phi.ui.Object,Binds:["onResize","onKeyDown"],element:null,parentComponent:null,className:null,displayAs:"block",options:{width:null,height:null,style:null,visible:undefined,enabled:undefined,buttonMode:undefined,paddingLeft:null,paddingTop:null,paddingRight:null,paddingBottom:null,backgroundColor:null},initialize:function(a){this.parent(a);this.addEvent("added",this.onAdded);this.addEvent("removed",this.onRemoved);window.addEvent("resize",this.onResize);window.addEvent("keydown",this.onKeyDown)},addClass:function(a){if(a===null)return;$(this).addClass(a)},removeClass:function(a){$(this).removeClass(a)},getPosition:function(){return $(this).getPosition()},setWidth:function(a){if(a===null)return;if(Number.isPercentage(a))$(this).setWidth(a);else $(this).setWidth(Number.withPx(a));this.dispatchEvent("widthChange",{value:a});return this},setHeight:function(a){if(a===null)return;if(Number.isPercentage(a))$(this).setHeight(a);else $(this).setHeight(Number.withPx(a));this.dispatchEvent("heightChange",{value:a});return this},getWidth:function(){return $(this).getWidth()},getHeight:function(){return $(this).getHeight()},setSize:function(a,b){this.setWidth(a);this.setHeight(b)},setParent:function(a){this.parentComponent=a},getParent:function(){return this.parentComponent},getParentView:function(){if(instanceOf(this,phi.ui.View))return this;if(this.getParent())return this.getParent().getParentView();return null},setVisible:function(a){if(a===undefined)return;if(typeof a=="string")a=Boolean.fromString(a);if(a)$(this).setStyle("display",this.displayAs);else $(this).setStyle("display","none")},getVisible:function(){var a=$(this).getStyle("display");return display!="none"},setEnabled:function(a){if(a===undefined)return;if(typeof a=="string")a=Boolean.fromString(a);if(a){$(this).removeClass("disabled");$(this).erase("disabled")}else{$(this).addClass("disabled");$(this).set("disabled","disabled")}},getEnabled:function(){return!$(this).hasClass("disabled")},setBackgroundColor:function(a){if(a===null||a===undefined)return;$(this).setStyle("background-color",a)},toElement:function(){if(this.element===null){this.element=this.createElement();this.initElement()}return this.element},isAddedToStage:function(){if(this.getParent()!==null)return this.getParent().isAddedToStage();if($(this).getParent()!==null)return true;return false},setPadding:function(a,b){if(b===null)return;$(this).setStyle("padding-"+a,Number.withPx(b))},setButtonMode:function(a){if(a===undefined)return;if(typeof a=="string")a=Boolean.fromString(a);$(this).removeClass("buttonMode");if(a)$(this).addClass("buttonMode")},getButtonMode:function(){return $(this).hasClass("buttonMode")},createElement:function(){throw new Error("CreateElement function not implemented.")}.protect(),initElement:function(){$(this).store("instance",this);$(this).addEvent("click",$bubbleEvent.bind(this));$(this).addEvent("dblclick",$bubbleEvent.bind(this));$(this).addEvent("keydown",$bubbleEvent.bind(this));$(this).addEvent("keypress",$bubbleEvent.bind(this));$(this).addEvent("keyup",$bubbleEvent.bind(this));$(this).addEvent("mousedown",$bubbleEvent.bind(this));$(this).addEvent("mousemove",$bubbleEvent.bind(this));$(this).addEvent("mouseout",$bubbleEvent.bind(this));$(this).addEvent("mouseover",$bubbleEvent.bind(this));$(this).addEvent("mouseup",$bubbleEvent.bind(this));$(this).addEvent("mouseenter",function(a){a.type="mouseenter";$bubbleEvent.bind(this)(a)}.bind(this));$(this).addEvent("mouseleave",function(a){a.type="mouseleave";$bubbleEvent.bind(this)(a)}.bind(this))}.protect(),onOptionsChange:function(){var a=this.options;this.setWidth(a.width);this.setHeight(a.height);this.addClass(a.style);this.setPadding("left",a.paddingLeft);this.setPadding("top",a.paddingTop);this.setPadding("right",a.paddingRight);this.setPadding("bottom",a.paddingBottom);this.setBackgroundColor(a.backgroundColor);this.setButtonMode(a.buttonMode);this.setVisible(a.visible);this.setEnabled(a.enabled);this.createWatchers()}.protect(),createWatchers:function(){var a=this.binds;for(var b in a){phi.mn.BindManager.bindUsingView(a[b].view,this,b,a[b].source,a[b].value)}},onAdded:function(a){},onRemoved:function(a){},onResize:function(a){},onKeyDown:function(a){}});phi.ui.Modal=new Class({Extends:phi.ui.Component,Binds:["onAdded","onWindowResize"],initialize:function(a){this.parent(a);this.addEvent("added",this.onAdded)},createElement:function(){return new Element("div",{"class":"phi-Modal"})}.protect(),initElement:function(){this.parent();$(this).setStyle("position","absolute");$(this).setStyle("top","0px");$(this).setStyle("left","0px")}.protect(),updateSize:function(){var a=window.getSize();this.setSize(a.x,a.y)},onAdded:function(){this.updateSize()}});phi.ui.Button=new Class({Extends:phi.ui.Component,text:"",setText:function(a){if(a===null)return;$(this).set("html",a)},getText:function(){return $(this).get("html")},createElement:function(){return new Element("button")}.protect(),initElement:function(){this.parent();$(this).addClass("phi-Button")}.protect(),onOptionsChange:function(){this.parent();this.setText(this.options.text)}});phi.ui.Button.create=function(a){var b=new phi.ui.Button(a);return b};phi.ui.CheckBox=new Class({Extends:phi.ui.Component,options:{checked:null},initialize:function(a){this.parent(a)},setChecked:function(a){if(a===null||a===undefined)return;$(this).checked=a},getChecked:function(){return $(this).checked},createElement:function(){return new Element("input",{type:"checkbox",checked:false})}.protect(),initElement:function(){this.parent();$(this).addClass("phi-CheckBox")}.protect(),onOptionsChange:function(){this.parent();this.setChecked(this.options.checked)}});phi.ui.CheckBox.create=function(a){var b=new phi.ui.CheckBox(a);return b};phi.ui.TextInput=new Class({Extends:phi.ui.Component,text:null,className:"phi.ui.TextInput",options:{text:null,color:null},initialize:function(a){this.parent(a);this.addEvent("keydown",this.onInputKeyDown);this.addEvent("keyup",this.onInputKeyUp)},setText:function(a){if(a===null)return;$(this).set("value",a);this.dispatchEvent("propertyChange",{property:"text",value:a})},getText:function(){return $(this).get("value")},setColor:function(a){if(a===null||a===undefined)return;$(this).setStyle("color",a)},displayAsPassword:function(a){if(a===null)return;if(a)$(this).set("type","password");else $(this).set("type","text")},createElement:function(){return new Element("input",{type:"text","class":"phi-TextInput"})},onOptionsChange:function(){this.parent();this.setText(this.options.text);this.setColor(this.options.color);this.displayAsPassword(this.options.displayAsPassword)},onInputKeyUp:function(a){this.dispatchEvent("textChange");this.dispatchEvent("propertyChange",{property:"text",value:this.getText()})},onInputKeyDown:function(a){if(a.key=="enter")this.dispatchEvent("enter")}});phi.ui.TextInput.create=function(a){var b=new phi.ui.TextInput(a);return b};phi.ui.Image=new Class({Extends:phi.ui.Component,options:{source:null},initialize:function(a){this.parent(a)},setSource:function(a){if(a===null||a===undefined)return;$(this).set("src",a)},getSource:function(){return $(this).get("src")},createElement:function(){return new Element("img")}.protect(),onOptionsChange:function(){this.parent();this.setSource(this.options.source)},initElement:function(){this.parent();$(this).setStyle("display","block");$(this).addClass("phi-Image")}.protect()});phi.ui.Image.create=function(a){var b=new phi.ui.Image(a);return b};phi.ui.Label=new Class({Extends:phi.ui.Component,text:"",options:{text:null,fontSize:null,color:null},setFontSize:function(a){if(a===null||a===undefined)return;$(this).setStyle("font-size",Number.withPx(a))},setColor:function(a){if(a===null||a===undefined)return;$(this).setStyle("color",a)},setText:function(a){if(a===null)return;$(this).set("html",a)},getText:function(){return $(this).get("html")},createElement:function(){return new Element("div")}.protect(),initElement:function(){this.parent();$(this).addClass("phi-Label");$(this).setStyle("cursor","default")}.protect(),onOptionsChange:function(){this.parent();this.setText(this.options.text);this.setColor(this.options.color);this.setFontSize(this.options.fontSize)}});phi.ui.Label.create=function(a){var b=new phi.ui.Label(a);return b};phi.ui.Container=new Class({Extends:phi.ui.Component,Implements:[phi.core.ChildList],initialize:function(a){this.parent(a);this.addEvent("childAdded",this.onChildAdded);this.addEvent("childRemoved",this.onChildRemoved);this.createChildren();this.prepareChildren();this.dispatchEvent("childrenCreated")},createChildren:function(){},prepareChildren:function(){},redrawChild:function(a){var b=new Element("div");b.inject($(a));setTimeout(function(){b.destroy()}.bind(this),1)},createIterator:function(){return new phi.core.Iterator(new phi.collections.ArrayCollection({source:this.children}))},createElement:function(){return new Element("div")}.protect(),onChildAdded:function(a){if(a.index==this.children.length-1)$(a.child).inject($(this));else $(a.child).inject($(this.getChildAt(a.index+1)),"before")},onChildRemoved:function(a){$(a.child).dispose()}});phi.ui.View=new Class({Extends:phi.ui.Container,data:null,message:null,useProxy:true,initialize:function(a){this.parent(a);this.initMessages();this.dispatchEvent("creationComplete")},useProxyObjects:function(a){if(a===null||a===undefined)return;this.useProxy=a},setData:function(a){if(a===null)return;this.data=this.wrapData(a);this.dispatchEvent("propertyChange",{property:"data",value:this.data})},getData:function(){return this.data},sendMessage:function(a,b){var c=phi.core.MessageDispatcher.getInstance();c.dispatchEvent(a,b)},onOptionsChange:function(){this.parent();this.useProxyObjects(this.options.useProxyObjects)}.protect(),initElement:function(){this.parent();$(this).addClass("phi-View")}.protect(),wrapData:function(a){var b=a;if(this.useProxy&&!instanceOf(a,phi.core.ProxyObject))b=new phi.core.ProxyObject(a);return b}.protect(),prepareChildren:function(a){Object.forEachChild(this,function(a){if(a.options.id){if(this[a.options.id])throw new Error("The id: "+a.options.id+" is allready used.");this[a.options.id]=a}}.bind(this),function(a){return!instanceOf(a,phi.ui.View)})},initMessages:function(){if(this.messages===null)return;var a=phi.core.MessageDispatcher.getInstance();for(var b in this.messages){var c=b;var d=this[this.messages[b]];a.addEvent(c,d.bind(this))}}.protect()});phi.ui.TitleWindow=new Class({Extends:phi.ui.Container,headerElement:null,titleElement:null,closeElement:null,bodyElement:null,drag:null,options:{title:null},setTitle:function(a){if(a===null||a===undefined)return;this.titleElement.set("html",a)},getTitle:function(){return this.titleElement.get("html")},onOptionsChange:function(){this.parent();this.setTitle(this.options.title)}.protect(),createElement:function(){var a=new Element("div");this.headerElement=new Element("div");this.headerElement.addEvent("mousedown",this.onHeaderClick.bind(this));this.titleElement=new Element("div",{html:""});this.bodyElement=new Element("div");this.closeElement=new Element("div");this.closeElement.addEvent("click",function(){this.dispatchEvent("close")}.bind(this));this.closeElement.inject(this.headerElement);this.titleElement.inject(this.headerElement);this.headerElement.inject(a);this.bodyElement.inject(a);return a}.protect(),initElement:function(){this.parent();this.headerElement.addClass("header");this.titleElement.addClass("title");this.bodyElement.addClass("body");this.closeElement.addClass("close");$(this).addClass("phi-TitleWindow")}.protect(),onChildAdded:function(a){if(a.index==this.children.length-1)$(a.child).inject(this.bodyElement);else $(a.child).inject($(this.getChildAt(a.index+1)),"before")},onChildRemoved:function(a){$(a.child).dispose()},onAdded:function(a){},onHeaderClick:function(a){if(!this.drag){var b=phi.mn.PopUpManager.getPopUpForView(this.getParent());if(b){console.log(b);this.drag=new Drag($(b),{handle:this.headerElement});this.drag.bound.start(a)}}}});phi.ui.TitleWindow.create=function(a){var b=new phi.ui.TitleWindow(a);return b};phi.ui.ViewStack=new Class({Extends:phi.ui.Container,selectedIndex:-1,setSelectedIndex:function(a){if(a<0||a>this.children.length)return;if(this.selectedIndex>-1)this.getChildAt(this.selectedIndex).setVisible(false);this.selectedIndex=Number.from(a);if(this.selectedIndex<this.children.length)this.getChildAt(this.selectedIndex).setVisible(true)},getSelectedIndex:function(){return this.selectedIndex},next:function(){var a=this.getSelectedIndex()+1;if(a>=this.children.length)return;this.setSelectedIndex(a)},prev:function(){var a=this.getSelectedIndex()-1;if(a<0)return;this.setSelectedIndex(a)},onOptionsChange:function(){this.parent();if(this.options.selectedIndex)this.setSelectedIndex(this.options.selectedIndex)}.protect(),onChildAdded:function(a){this.parent(a);if(this.children.length>1)a.child.setVisible(false)}.protect(),onChildRemoved:function(a){this.parent(a)},initElement:function(){this.parent();$(this).addClass("phi-ViewStack")}.protect()});phi.ui.ViewStack.create=function(a){var b=new phi.ui.ViewStack(a);return b};phi.ui.HTMLBox=new Class({Extends:phi.ui.Container,initialize:function(a,b){this.parent(b);if(!a)throw new Error("HTMLBox element parameter is require!");$(this).inject($(a))},initElement:function(){this.parent();$(this).addClass("phi-HTMLBox")}.protect(),onAdded:function(a){throw new Error("You can't add HTMLBox as a child please use other container!")}});phi.ui.ScrollBox=new Class({Extends:phi.ui.Container,initialize:function(){this.parent()},initElement:function(){this.parent();$(this).addClass("phi-ScrollBox");$(this).setStyle("overflow","auto")}.protect(),createElement:function(){return new Element("div")}.protect()});phi.ui.CellBox=new Class({Extends:phi.ui.Container,options:{horizontalAlign:"left",verticalAlign:"middle",border:0},table:null,getTable:function(){if(!this.table)this.table=new phi.html.Table;return this.table},setChildVerticalAlign:function(a,b){if(instanceOf(a,Number))a=this.getChildAt(a);if(this.hasChild(a))$(a).getParent().set("valign",b);if(Browser.chrome||Browser.safari)this.redrawChild(a)},setChildHorizontalAlign:function(a,b){if(instanceOf(a,Number))a=this.getChildAt(a);if(this.hasChild(a))$(a).getParent().set("align",b);if(Browser.chrome||Browser.safari)this.redrawChild(a)},setVerticalAlign:function(a){this.options.verticalAlign=a;var b=this.createIterator();while(b.moveNext())this.setChildVerticalAlign(b.current(),a);return this},getVerticalAlign:function(){return this.options.verticalAlign},setHorizontalAlign:function(a){this.options.horizontalAlign=a;var b=this.createIterator();while(b.moveNext())this.setChildHorizontalAlign(b.current(),a);return this},getHorizontalAlign:function(){return this.options.horizontalAlign},setCellWidth:function(a,b,c){var d=this.getTable().td(a,b);if(d)d.set("width",c)},setCellHeight:function(a,b,c){var d=this.getTable().td(a,b);if(d)d.set("height",c)},setBorder:function(a){$(this).set("border",a)},getBorder:function(){return Number.from($(this).get("border"))},createElement:function(){return $(this.getTable())}.protect(),initElement:function(){this.parent();$(this).addClass("phi-CellBox")}.protect(),onOptionsChange:function(){var a=this.options;this.parent();this.setBorder(a.border);this.setVerticalAlign(a.verticalAlign);this.setHorizontalAlign(a.horizontalAlign)}.protect()});phi.ui.CellBox.create=function(a){var b=new phi.ui.CellBox(a);return b};phi.ui.RootBox=new Class({Extends:phi.ui.Container,percentageWidth:0,percentageHeight:0,initialize:function(){this.parent();if(phi.ui.RootBox.instance)throw new Error("Please use phi.ui.RootBox.get() to access RootBox!");phi.ui.RootBox.instance=this},updateSize:function(){if(this.percentageWidth>0)this.setWidth($(this).getParent().getSize().x*this.percentageWidth/100);if(this.percentageHeight>0)this.setHeight($(this).getParent().getSize().y*this.percentageHeight/100)},setPercentageWidth:function(a){this.percentageWidth=a;this.updateSize()},setPercentageHeight:function(a){this.percentageHeight=a;this.updateSize()},createElement:function(){return new Element("div")}.protect(),initElement:function(){this.parent();$(this).addClass("phi-RootBox")}.protect(),onAddedToStage:function(a){}.protect(),onResize:function(a){this.updateSize()}});phi.ui.RootBox.getInstance=function(){return phi.ui.RootBox.instance||new phi.ui.RootBox};phi.ui.RootBox.get=function(){var a=$$("body")[0];var b=a.retrieve("rootBox");if(b)return b;b=phi.ui.RootBox.getInstance();a.store("rootBox",b);$(b).inject(a);b.dispatchEvent("added",{index:0});return b};phi.ui.PopUp=new Class({Extends:phi.ui.Container,Binds:["onWindowMouseUp"],uid:"",options:{hideOnClick:false,relativeTo:null,allowNegative:false},initialize:function(a){this.parent(a);window.addEvent("mouseup",this.onWindowMouseUp)},center:function(){$(this).position()},snapTo:function(a,b){if(!b)b=PopUpSnap.BOTTOM;this.show();$(this).position({relativeTo:$(a),position:PopUpSnap.mapSide[b],edge:PopUpSnap.mapEdge[b],allowNegative:true})},snapToElement:function(a,b){this.show();b.relativeTo=a;b.allowNegative=true;$(this).position(b)},setX:function(a){$(this).setStyle("left",a)},setY:function(a){$(this).setStyle("top",a)},setPosition:function(a,b){this.setX(a);this.setY(b)},hide:function(){phi.mn.PopUpManager.removePopUp(this);return this},show:function(a){phi.mn.PopUpManager.addPopUp(this,a);return this},isVisible:function(){var a=phi.ui.RootBox.get();return a.hasChild(this)},onChildAdded:function(a){$(a.child).inject($(this))},onChildRemoved:function(a){$(a.child).dispose()},onWindowMouseUp:function(a){if(this.isVisible()){if(this.options.hideOnClick){if(!$(this).contains(a.target))this.hide()}}},createElement:function(){return new Element("div")}.protect(),initElement:function(){this.parent();$(this).setStyle("position","absolute");$(this).setStyle("top","0px");$(this).setStyle("left","0px");$(this).addClass("phi-PopUp")}.protect(),onResize:function(a){this.hide()}});phi.ui.HBox=new Class({Extends:phi.ui.CellBox,Binds:["onChildWidthChange"],options:{gap:0},setCellWidth:function(a,b){this.parent(0,a,b)},setCellHeight:function(a,b){this.parent(0,a,b)},setGap:function(a){this.options.gap=a;for(var b=1;b<this.children.length;b++){this.getTable().td(0,b).setStyle("padding-left",Number.withPx(a))}},getGap:function(){return this.options.gap},onOptionsChange:function(){this.parent();this.setGap(this.options.gap)}.protect(),onChildAdded:function(a){var b=this.getTable().pushElement($(a.child),0,a.index).td;this.setChildVerticalAlign(a.child,this.getVerticalAlign());this.setChildHorizontalAlign(a.child,this.getHorizontalAlign());if(a.index>0)b.setStyle("padding-left",Number.withPx(this.getGap()));a.child.addEvent("widthChange",this.onChildWidthChange);this.updateCellWidth(a.child)}.protect(),onChildRemoved:function(a){$(a.child).getParent().dispose()},onChildWidthChange:function(a){this.updateCellWidth(a.target)},updateCellWidth:function(a){var b=a.getWidth();var c=this.getChildIndex(a);if(b)this.setCellWidth(c,b)},initElement:function(){this.parent();$(this).removeClass("phi-CellBox");$(this).addClass("phi-HBox")}.protect()});phi.ui.HBox.create=function(a){var b=new phi.ui.HBox(a);return b};phi.ui.VBox=new Class({Extends:phi.ui.CellBox,Binds:["onChildHeightChange"],options:{gap:0},setCellWidth:function(a,b){this.parent(a,0,b)},setCellHeight:function(a,b){this.parent(a,0,b)},setGap:function(a){this.options.gap=a;for(var b=1;b<this.children.length;b++){this.getTable().td(b,0).setStyle("padding-top",Number.withPx(a))}},getGap:function(){return this.options.gap},onOptionsChange:function(){this.parent();this.setGap(this.options.gap)}.protect(),onChildAdded:function(a){var b=this.getTable().pushElement($(a.child),a.index).td;this.setChildVerticalAlign(a.child,this.getVerticalAlign());this.setChildHorizontalAlign(a.child,this.getHorizontalAlign());if(a.index>0)b.setStyle("padding-top",Number.withPx(this.getGap()));a.child.addEvent("heightChange",this.onChildHeightChange);this.updateCellHeight(a.child)}.protect(),onChildRemoved:function(a){$(a.child).getParentByTag("tr").dispose()},onChildHeightChange:function(a){this.updateCellHeight(a.target)},updateCellHeight:function(a){var b=a.getHeight();var c=this.getChildIndex(a);if(b)this.setCellHeight(c,b)},initElement:function(){this.parent();$(this).removeClass("phi-CellBox");$(this).addClass("phi-VBox")}.protect()});phi.ui.VBox.create=function(a){var b=new phi.ui.VBox(a);return b};phi.ui.ItemRenderer=new Class({Extends:phi.ui.View,createElement:function(){return new Element("div")}.protect(),initElement:function(){this.parent();$(this).removeClass("phi-View")}.protect()});phi.ui.ListItemRenderer=new Class({Extends:phi.ui.ItemRenderer,list:null,className:"phi.ui.ListItemRenderer",createElement:function(){return new Element("li",{"class":"phi-ListItem"})}.protect()});phi.ui.DefaultListItemRenderer=new Class({Extends:phi.ui.ListItemRenderer,initialize:function(){this.parent();var a=new phi.ui.Label;var b=new phi.ui.HBox({width:"100%",height:35,paddingLeft:10});b.addChild(a);phi.mn.BindManager.bindUsingView(this,a,"text","data","label");this.addChild(b)}});phi.ui.MenuItemRenderer=new Class({Extends:phi.ui.ListItemRenderer,initialize:function(){this.parent();var a=new phi.ui.Label;var b=new phi.ui.HBox({width:"100%",paddingLeft:10,paddingRight:5});b.addChild(a);phi.mn.BindManager.bindUsingView(this,a,"text","data","label");this.addChild(b)}});phi.ui.MenuSeparatorRenderer=new Class({Extends:phi.ui.ListItemRenderer,initialize:function(){this.parent()},createElement:function(){var a=new Element("li",{"class":"phi-Separator"});return a}.protect()});phi.ui.ListBase=new Class({Extends:phi.ui.Container,Binds:["onCollectionChange","onItemClick","onItemRollOver","onItemRollOut"],options:{selectable:true,dataProvider:null,itemRenderer:null,itemRendererFunction:null,selectedItem:null,selectedIndex:null},itemRenderer:null,itemRendererFunction:null,dataProvider:null,initialize:function(a){this.parent(a);if(this.itemRenderer===null)this.itemRenderer=phi.ui.DefaultListItemRenderer;this.addEvent("newDataProvider",this.onNewDataProvider)},setDataProvider:function(a){if(a===null||a===undefined)return;if(!instanceOf(a,phi.collections.ArrayCollection))throw new Error("DataProvider must be a ArrayCollection!");this.dataProvider=a;this.dataProvider.addEvent("collectionChange",this.onCollectionChange);this.dispatchEvent("newDataProvider")},getDataProvider:function(){return this.dataProvider},setItemRenderer:function(a){if(a===null)return;this.itemRenderer=a;this.rebuildItems()},getItemRenderer:function(){return this.itemRenderer},setItemRendererFunction:function(a){if(a===null)return;this.itemRendererFunction=a},getItemRendererFunction:function(){return this.itemRendererFunction},setSelectable:function(a){if(a===null)return;this.options.selectable=a},getSelectable:function(){return this.options.selectable},setSelectedIndex:function(a){if(a===null)return;if(!this.getSelectable())return;this.options.selectedIndex=a;this.removeItemsClass("selected");if(a>-1)this.getChildAt(a).element.addClass("selected");this.dispatchEvent("propertyChange",{property:"selectedIndex",value:a})},getSelectedIndex:function(){return this.options.selectedIndex},setSelectedItem:function(a){var b=this.getDataProvider().getItemIndex(a);this.setSelectedIndex(b)},getSelectedItem:function(){if(this.getDataProvider()===null)return null;if(this.getSelectedIndex()==-1)return null;return this.getDataProvider().getItemAt(this.getSelectedIndex())},elementToIndex:function(a){var b=a;if(b.get("tag")!="li")b=a.getParentByTag("li");if(!b)return-1;return this.getDataProvider().getItemIndex(b.instance().getData())},createElement:function(){return new Element("ul",{"class":"phi-ListBase"})}.protect(),createItem:function(a){var b=this.getItemRenderer();if(this.getItemRendererFunction()){var c=this.getItemRendererFunction();b=c(a)}var d=new b;if(!instanceOf(d,phi.ui.ListItemRenderer))throw new Error("ItemRenderer must be an instance of phi.ui.ListItemRenderer!");d.setData(a);d.list=this;d.addEvent("mouseenter",this.onItemRollOver);d.addEvent("mouseleave",this.onItemRollOut);d.addEvent("mousedown",this.onItemClick);var e=this.getDataProvider().getItemIndex(a);if(e%2!=0)$(d).addClass("odd");return d}.protect(),rebuildItems:function(){if(!this.getDataProvider())return;var a=this.getDataProvider().createIterator();this.removeAllChildren();$(this).empty();while(a.moveNext()){var b=this.createItem(a.current());this.addChild(b)}},moveItem:function(a,b){if(!b)b=this.getSelectedItem();if(!b)return;var c=this.getDataProvider();var d=c.getItemIndex(b);if(a=="up"){if(d>0)d--}else if(a=="down"){if(d<c.length())d++}c.moveItem(b,d)},removeItemsClass:function(a){var b=this.createIterator();while(b.moveNext())$(b.current()).removeClass(a)},onOptionsChange:function(){this.parent();this.setSelectable(this.options.selectable);this.setItemRendererFunction(this.options.itemRendererFunction);this.setItemRenderer(this.options.itemRenderer);this.setDataProvider(this.options.dataProvider);this.setSelectedIndex(this.options.setSelectedIndex)},onItemRollOver:function(a){var b=this.elementToIndex(a.target);$(this.getChildAt(b)).addClass("over");this.dispatchEvent("itemRollOver",{index:b})},onItemRollOut:function(a){var b=this.elementToIndex(a.target);$(this.getChildAt(b)).removeClass("over");this.dispatchEvent("itemRollOut",{index:b})},onNewDataProvider:function(){this.rebuildItems()},onCollectionChange:function(a){switch(a.kind){case CollectionEventKind.ADD:{var b=this.createItem(a.item);this.addChildAt(b,a.location);this.setSelectedIndex(-1);break};case CollectionEventKind.REMOVE:{this.removeChildAt(a.location);this.setSelectedIndex(-1);break};case CollectionEventKind.REPLACE:{this.getChildAt(a.location).setData(a.item);break};case CollectionEventKind.MOVE:{var c=this.removeChildAt(a.oldLocation);this.addChildAt(c,a.location);this.setSelectedIndex(-1);break}}this.updateOddClass()},updateOddClass:function(){var a=this.getDataProvider().createIterator();for(var b=0;b<this.getChildren().length;b++){var c=this.getChildAt(b);if($(c).hasClass("odd"))$(c).removeClass("odd");if(b%2!=0)$(c).addClass("odd")}},onItemClick:function(a){var b=this.elementToIndex(a.target);this.setSelectedIndex(b);this.dispatchEvent("itemClick",{index:b})},onKeyDown:function(a){var b=-1;if(a.key=="up"){b=this.getSelectedIndex();if(a.alt)this.moveItem("up");if(b>0)this.setSelectedIndex(b-1)}else if(a.key=="down"){b=this.getSelectedIndex();if(a.alt)this.moveItem("down");if(b<this.getDataProvider().length()-1)this.setSelectedIndex(b+1)}}});phi.ui.List=new Class({Extends:phi.ui.ListBase,className:"phi.ui.List",initialize:function(a){this.parent(a)},initElement:function(){this.parent();$(this).removeClass("phi-ListBase");$(this).addClass("phi-List")}.protect()});phi.ui.List.create=function(a){var b=new phi.ui.List(a);return b};phi.ui.Menu=new Class({Extends:phi.ui.PopUp,Binds:["onItemRollOver","onItemClick"],options:{hideOnClick:true},list:null,parentChild:null,parentMenu:null,childMenu:null,initialize:function(a){this.parent(a);this.childMenu=null;this.parentChild=null;this.list=phi.ui.List.create({width:"100%",height:"100%",selectable:false,itemRendererFunction:this.listItemRendererFunction});this.list.addEvent("itemRollOver",this.onItemRollOver);this.list.addEvent("itemClick",this.onItemClick);this.addChild(this.list)},setDataProvider:function(a){this.list.setDataProvider(a)},getDataProvider:function(){return this.list.getDataProvider()},show:function(a,b){this.setPosition(a,b);this.parent()},hide:function(){this.parent();this.parentChild=null;this.list.setSelectedIndex(-1);this.list.removeItemsClass("over");if(this.childMenu)this.childMenu.hide()},listItemRendererFunction:function(a){if(a.get("type")=="separator")return phi.ui.MenuSeparatorRenderer;return phi.ui.MenuItemRenderer},elementToMenu:function(a){var b=a.getParentByClass("phi-Menu");if(b)return b.instance();return null},initElement:function(){this.parent();$(this).addClass("phi-Menu")}.protect(),onItemClick:function(a){var b=a.index;var c=this.getDataProvider().getItemAt(b);var d={index:b,item:c,menu:this};this.bubbleItemClick(d)},bubbleItemClick:function(a){if(this.parentMenu===null){this.dispatchEvent("itemClick",a);return}this.parentMenu.bubbleItemClick(a)},onItemRollOver:function(a){var b=this.list.getChildAt(a.index);var c=b.getData().children;if(this.childMenu&&b!=this.childMenu.parentChild)this.childMenu.hide();if(c){if(!this.childMenu)this.childMenu=new phi.ui.Menu;if(b!=this.childMenu.parentChild){this.childMenu.parentChild=b;this.childMenu.parentMenu=this;this.childMenu.setDataProvider(c);this.childMenu.snapToElement($(b),{position:"topRight",offset:{x:5,y:0}});if(window.getWidth()<this.childMenu.getPosition().x+this.childMenu.getWidth()){this.childMenu.snapToElement($(b),{position:"topLeft",edge:"topRight",offset:{x:-5,y:0}})}if(window.getHeight()<this.childMenu.getPosition().y+this.childMenu.getHeight()){$(this.childMenu).setStyle("top",window.getHeight()-this.childMenu.getHeight())}}}},onWindowMouseUp:function(a){var b=a.target.getParentByClass("phi-ListItem");if(this.isVisible()){if(b)if(b.instance().getData().children)return;this.hide()}},onResize:function(a){this.hide()}});phi.ui.Menu.create=function(a){var b=new Phi.UI.Menu(a);return b}